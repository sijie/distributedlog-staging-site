<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>LogReader (Apache DistributedLog for Java, version latest)</title>
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="LogReader (Apache DistributedLog for Java, version latest)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6,"i1":6,"i2":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/LogReader.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/apache/distributedlog/LocalDLMEmulator.Builder.html" title="class in org.apache.distributedlog"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../org/apache/distributedlog/LogRecord.html" title="class in org.apache.distributedlog"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/apache/distributedlog/LogReader.html" target="_top">Frames</a></li>
<li><a href="LogReader.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.distributedlog</div>
<h2 title="Interface LogReader" class="title">Interface LogReader</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Superinterfaces:</dt>
<dd><a href="http://download.oracle.com/javase/6/docs/api/java/lang/AutoCloseable.html?is-external=true" title="class or interface in java.lang">AutoCloseable</a>, <a href="http://download.oracle.com/javase/6/docs/api/java/io/Closeable.html?is-external=true" title="class or interface in java.io">Closeable</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">LogReader</span>
extends <a href="http://download.oracle.com/javase/6/docs/api/java/io/Closeable.html?is-external=true" title="class or interface in java.io">Closeable</a></pre>
<div class="block"><i>LogReader</i> is a `synchronous` reader reading records from a DL log.

 <h3>Lifecycle of a Reader</h3>

 <p>A reader is a <i>sequential</i> reader that read records from a DL log starting
 from a given position. The position could be a <i>DLSN</i> (via <a href="../../../org/apache/distributedlog/DistributedLogManager.html#getInputStream-org.apache.distributedlog.DLSN-"><code>DistributedLogManager.getInputStream(DLSN)</code></a>
 or a <i>Transaction ID</i> (via <a href="../../../org/apache/distributedlog/DistributedLogManager.html#getInputStream-long-"><code>DistributedLogManager.getInputStream(long)</code></a>.

 <p>After the reader is open, it could call <a href="../../../org/apache/distributedlog/LogReader.html#readNext-boolean-"><code>readNext(boolean)</code></a> or <a href="../../../org/apache/distributedlog/LogReader.html#readBulk-boolean-int-"><code>readBulk(boolean, int)</code></a>
 to read records out the log from provided position.

 <p>Closing the reader (via <a href="http://download.oracle.com/javase/6/docs/api/java/io/Closeable.html?is-external=true#close--" title="class or interface in java.io"><code>Closeable.close()</code></a> will release all the resources occupied
 by this reader instance.

 <p>Exceptions could be thrown during reading records. Once the exception is thrown,
 the reader is set to an error state and it isn't usable anymore. It is the application's
 responsibility to handle the exceptions and re-create readers if necessary.

 <p>Example:
 <pre>
 DistributedLogManager dlm = ...;
 long nextTxId = ...;
 LogReader reader = dlm.getInputStream(nextTxId);

 while (true) { // keep reading & processing records
     LogRecord record;
     try {
         record = reader.readNext(false);
         nextTxId = record.getTransactionId();
         // process the record
         ...
     } catch (IOException ioe) {
         // handle the exception
         ...
         reader = dlm.getInputStream(nextTxId + 1);
     }
 }

 </pre>

 <h3>Read Records</h3>

 <p>Reading records from an <i>endless</i> log in `synchronous` way isn't as
 trivial as in `asynchronous` way (via <a href="../../../org/apache/distributedlog/AsyncLogReader.html" title="interface in org.apache.distributedlog"><code>AsyncLogReader</code></a>. Because it
 lacks of callback mechanism. LogReader introduces a flag `nonBlocking` on
 controlling the <i>waiting</i> behavior on `synchronous` reads.

 <h4>Blocking vs NonBlocking</h4>

 <i>Blocking</i> (nonBlocking = false) means the reads will wait for records
 before returning read calls. While <i>NonBlocking</i> (nonBlocking = true)
 means the reads will only check readahead cache and return whatever records
 available in the readahead cache.

 <p>The <i>waiting</i> period varies in <i>blocking</i> mode. If the reader is
 catching up with writer (there are records in the log), the read call will
 wait until records are read and returned. If the reader is caught up with
 writer (there are no more records in the log at read time), the read call
 will wait for a small period of time (defined in
 <a href="../../../org/apache/distributedlog/DistributedLogConfiguration.html#getReadAheadWaitTime--"><code>DistributedLogConfiguration.getReadAheadWaitTime()</code></a> and return whatever
 records available in the readahead cache. In other words, if a reader sees
 no record on blocking reads, it means the reader is `caught-up` with the
 writer.

 <p><i>Blocking</i> and <i>NonBlocking</i> modes are useful for building replicated
 state machines. Applications could use <i>blocking</i> reads till caught up
 with latest data. Once they are caught up with latest data, they could start
 serving their service and turn to <i>non-blocking</i> read mode and tail read
 data from the logs.

 <p>See examples below.

 <h4>Read Single Record</h4>

 <a href="../../../org/apache/distributedlog/LogReader.html#readNext-boolean-"><code>readNext(boolean)</code></a> is reading individual records from a DL log.

 <pre>
 LogReader reader = ...

 // keep reading records in blocking way until no records available in the log
 LogRecord record = reader.readNext(false);
 while (null != record) {
     // process the record
     ...
     // read next record
     records = reader.readNext(false);
 }

 ...

 // reader is caught up with writer, doing non-blocking reads to tail the log
 while (true) {
     record = reader.readNext(true)
     // process the new records
     ...
 }
 </pre>

 <h4>Read Batch of Records</h4>

 <a href="../../../org/apache/distributedlog/LogReader.html#readBulk-boolean-int-"><code>readBulk(boolean, int)</code></a> is a convenient way to read a batch of records
 from a DL log.

 <pre>
 LogReader reader = ...
 int N = 10;

 // keep reading N records in blocking way until no records available in the log
 List&lt;LogRecord&gt; records = reader.readBulk(false, N);
 while (!records.isEmpty()) {
     // process the list of records
     ...
     if (records.size() < N) { // no more records available in the log
         break;
     }
     // read next N records
     records = reader.readBulk(false, N);
 }

 ...

 // reader is caught up with writer, doing non-blocking reads to tail the log
 while (true) {
     records = reader.readBulk(true, N)
     // process the new records
     ...
 }

 </pre>

 <p>NOTE: Extending <a href="../../../org/apache/distributedlog/io/AsyncCloseable.html" title="interface in org.apache.distributedlog.io"><code>AsyncCloseable</code></a>: BKSyncLogReader is implemented based on BKAsyncLogReader, exposing
 the <a href="../../../org/apache/distributedlog/io/AsyncCloseable.html" title="interface in org.apache.distributedlog.io"><code>AsyncCloseable</code></a> interface so the reader could be closed asynchronously</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../org/apache/distributedlog/AsyncLogReader.html" title="interface in org.apache.distributedlog"><code>AsyncLogReader</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>com.twitter.util.Future&lt;<a href="http://download.oracle.com/javase/6/docs/api/java/lang/Void.html?is-external=true" title="class or interface in java.lang">Void</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../org/apache/distributedlog/LogReader.html#asyncClose--">asyncClose</a></span>()</code>
<div class="block">Closes this source and releases any system resources associated
 with it.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code><a href="http://download.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../org/apache/distributedlog/LogRecordWithDLSN.html" title="class in org.apache.distributedlog">LogRecordWithDLSN</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../org/apache/distributedlog/LogReader.html#readBulk-boolean-int-">readBulk</a></span>(boolean&nbsp;nonBlocking,
        int&nbsp;numLogRecords)</code>
<div class="block">Read the next <i>numLogRecords</i> log records from the stream.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="../../../org/apache/distributedlog/LogRecordWithDLSN.html" title="class in org.apache.distributedlog">LogRecordWithDLSN</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../org/apache/distributedlog/LogReader.html#readNext-boolean-">readNext</a></span>(boolean&nbsp;nonBlocking)</code>
<div class="block">Read the next log record from the stream.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.io.Closeable">
<!--   -->
</a>
<h3>Methods inherited from interface&nbsp;java.io.<a href="http://download.oracle.com/javase/6/docs/api/java/io/Closeable.html?is-external=true" title="class or interface in java.io">Closeable</a></h3>
<code><a href="http://download.oracle.com/javase/6/docs/api/java/io/Closeable.html?is-external=true#close--" title="class or interface in java.io">close</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="readNext-boolean-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>readNext</h4>
<pre><a href="../../../org/apache/distributedlog/LogRecordWithDLSN.html" title="class in org.apache.distributedlog">LogRecordWithDLSN</a>&nbsp;readNext(boolean&nbsp;nonBlocking)
                    throws <a href="http://download.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Read the next log record from the stream.

 <p>If <i>nonBlocking</i> is set to true, the call returns immediately by just polling
 records from read ahead cache. It would return <i>null</i> if there isn't any records
 available in the read ahead cache.

 <p>If <i>nonBlocking</i> is set to false, it would does blocking call. The call will
 block until return a record if there are records in the stream (aka catching up).
 Otherwise it would wait up to <a href="../../../org/apache/distributedlog/DistributedLogConfiguration.html#getReadAheadWaitTime--"><code>DistributedLogConfiguration.getReadAheadWaitTime()</code></a>
 milliseconds and return null if there isn't any more records in the stream.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>nonBlocking</code> - should the read make blocking calls to the backend or rely on the
 readAhead cache</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>an operation from the stream or null if at end of stream</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://download.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - if there is an error reading from the stream</dd>
</dl>
</li>
</ul>
<a name="readBulk-boolean-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>readBulk</h4>
<pre><a href="http://download.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../org/apache/distributedlog/LogRecordWithDLSN.html" title="class in org.apache.distributedlog">LogRecordWithDLSN</a>&gt;&nbsp;readBulk(boolean&nbsp;nonBlocking,
                                 int&nbsp;numLogRecords)
                          throws <a href="http://download.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Read the next <i>numLogRecords</i> log records from the stream.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>nonBlocking</code> - should the read make blocking calls to the backend or rely on the
 readAhead cache</dd>
<dd><code>numLogRecords</code> - maximum number of log records returned by this call.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>an operation from the stream or empty list if at end of stream</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://download.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - if there is an error reading from the stream</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../org/apache/distributedlog/LogReader.html#readNext-boolean-"><code>readNext(boolean)</code></a></dd>
</dl>
</li>
</ul>
<a name="asyncClose--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>asyncClose</h4>
<pre>com.twitter.util.Future&lt;<a href="http://download.oracle.com/javase/6/docs/api/java/lang/Void.html?is-external=true" title="class or interface in java.lang">Void</a>&gt;&nbsp;asyncClose()</pre>
<div class="block">Closes this source and releases any system resources associated
 with it. If the source is already closed then invoking this
 method has no effect.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>future representing the close result.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/LogReader.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/apache/distributedlog/LocalDLMEmulator.Builder.html" title="class in org.apache.distributedlog"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../org/apache/distributedlog/LogRecord.html" title="class in org.apache.distributedlog"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/apache/distributedlog/LogReader.html" target="_top">Frames</a></li>
<li><a href="LogReader.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2016-2017 <a href="http://www.apache.org/">The Apache Software Foundation</a>. All Rights Reserved.</small></p>
</body>
</html>
